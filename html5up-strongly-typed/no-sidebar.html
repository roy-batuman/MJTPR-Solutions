<!DOCTYPE HTML>
<html>
<head>
	<title>E-Commerce</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />
	<style>
		/* small overrides for the product grid and cart */
		.products { display: grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap: 1rem; margin-top:1rem; }
		.product { border:1px solid #e6e6e6; border-radius:8px; padding:12px; background:#fff; }
		.product img { width:100%; height:160px; object-fit:cover; border-radius:6px; }
		.price { font-weight:700; margin-top:8px; }
		.add-btn { margin-top:10px; display:inline-block; }
		#cartPanel { position:fixed; right:16px; top:80px; width:320px; max-height:70vh; overflow:auto; background:#fff; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,.12); padding:14px; z-index:999; display:none; }
		#cartToggle { position:fixed; right:16px; top:16px; z-index:1000; }
		.cart-item { display:flex; gap:10px; margin-bottom:10px; align-items:center; }
		.cart-item img { width:56px; height:56px; object-fit:cover; border-radius:6px; }
		.qty-input { width:52px; }
		.cart-footer { border-top:1px solid #eee; padding-top:10px; margin-top:8px; }
		.small-muted { font-size:0.9rem; color:#666; }
		.success { background: #e6ffed; padding:8px; border-radius:6px; color:#1b7a3a; margin-bottom:8px; }
	</style>
</head>
<body class="no-sidebar is-preload">
	<div id="page-wrapper">

		<!-- Header -->
		<section id="header">
			<div class="container">
				<!-- Logo -->
				<h1 id="logo"><a href="index.html">E-Commerce Demo</a></h1>
				<p>Current products available</p>

				<!-- Nav -->
				<nav id="nav">
					<ul>
              			<li><a class="icon solid fa-home" href="index.html"><span>Home Page</span></a></li>
              			<li><a class="icon solid fa-graduation-cap" href="left-sidebar.html"><span>Scholarships</span></a></li>
             			<li><a class="icon solid fa-users" href="right-sidebar.html"><span>Memberships</span></a></li>
             			<li><a class="icon solid fa-donate" href="Ecommerce.html"><span>E-Commerce</span></a></li>
            			</ul>
				</nav>
			</div>
		</section>

		<!-- Main -->
		<section id="main">
			<div class="container">
				<header>
					<h2>Shop</h2>
					<p>Browse products — add to cart and checkout using PayPal (sandbox) or the mock card flow.</p>
				</header>

				<!-- Products -->
				<div id="content">
					<div class="products" id="productsGrid">
						<!-- products rendered by JS -->
					</div>
				</div>
			</div>
		</section>

		 <!-- Footer -->
<section id="footer">
    <div class="container">
        <header>
            <h2>Questions or comments? <strong>Get in touch:</strong></h2>
        </header>
        <div class="row">

            <!-- Removed form column -->
            <div class="col-12">
                <section>
                    <p>Please feel free to contact us at any time. We welcome new members who want to make a difference.</p>
                    <div class="row">
                        <div class="col-6 col-12-small">
                            <ul class="icons">
                                <li class="icon solid fa-home">
                                    P.O. Box 10911 Naples, FL 34101 USA
                                </li>
                                <li class="icon solid fa-phone">(973) 864-7087</li>
                            </ul>
                        </div>
                        <div class="col-6 col-12-small">
                            <ul class="icons">
                                <li class="icon brands fa-facebook-f">
                                    <a href="#">facebook.com/ZontaNaples/</a>
                                </li>
                                <li class="icon solid fa-envelope">
                                    <a href="#">info@zonta-naples.org</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>

        </div>
    </div>
</section>
	</div>

	<!-- Cart toggle & panel -->
	<button id="cartToggle" class="button">Cart (<span id="cartCount">0</span>)</button>
	<div id="cartPanel" aria-hidden="true">
		<div id="cartMessages"></div>
		<h3>Your Cart</h3>
		<div id="cartItems"></div>
		<div class="cart-footer">
			<div><strong>Total: $<span id="cartTotal">0.00</span></strong></div>
			<div class="small-muted">Taxes and shipping not calculated (demo).</div>
			<div style="margin-top:10px;">
				<!-- PayPal buttons will render here -->
				<div id="paypalButtonsContainer"></div>
				<button id="mockCard" class="button">Pay with Mock Card (demo)</button>
			</div>
		</div>
	</div>

	<!-- Scripts -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/jquery.dropotron.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<!-- PayPal SDK: client-id=sb uses sandbox (demo). Replace with your live client-id for production. -->
	<script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>

	<script>
		// Product data
		const products = [
			{
				id: 'p001',
				title: 'Zonta Masks (2 Pack)',
				price: 19.99,
				image: 'ZontaMask.jpg',
				desc: 'Protect yourself from germs and other environmental elements with the 3-Ply Face Mask. This non-medical grade mask is washable and reusable so you can wear multiple times. Made from a polyester material, this face shield wicks moisture to keep you cool and dry.'
			},
			{
				id: 'p002',
				title: 'Wireless Earbuds Pro',
				price: 79.99,
				image: 'images/pic02.jpg',
				desc: 'Noise-cancelling earbuds with 24h battery life.'
			},
			{
				id: 'p003',
				title: 'Insulated Water Bottle - 500ml',
				price: 19.50,
				image: 'images/pic03.jpg',
				desc: 'Keeps drinks cold for 24h and hot for 12h.'
			},
			{
				id: 'p004',
				title: 'Organic Cotton T-shirt',
				price: 24.00,
				image: 'images/pic01.jpg',
				desc: 'Soft organic cotton, available in multiple sizes (demo).'
			}
		];

		// Utility: currency format
		const format = v => Number(v).toFixed(2);

		// Render products to grid
		const grid = document.getElementById('productsGrid');
		products.forEach(p => {
			const el = document.createElement('div');
			el.className = 'product';
			el.innerHTML = `
				<img src="${p.image}" alt="${p.title}" />
				<h4>${p.title}</h4>
				<div class="small-muted">${p.desc}</div>
				<div class="price">$${format(p.price)}</div>
				<button class="button add-btn" data-id="${p.id}">Add to cart</button>
			`;
			grid.appendChild(el);
		});

		// Cart management (localStorage)
		const CART_KEY = 'demo_cart_v1';
		let cart = JSON.parse(localStorage.getItem(CART_KEY) || '{}');

		function saveCart() {
			localStorage.setItem(CART_KEY, JSON.stringify(cart));
			updateCartUI();
		}

		function addToCart(id, qty = 1) {
			if (!cart[id]) cart[id] = 0;
			cart[id] += qty;
			saveCart();
			showTemporaryMessage('Added to cart');
		}

		function removeFromCart(id) {
			delete cart[id];
			saveCart();
		}

		function changeQty(id, qty) {
			if (qty <= 0) removeFromCart(id);
			else cart[id] = qty;
			saveCart();
		}

		function cartItemsList() {
			return Object.keys(cart).map(id => {
				const prod = products.find(p => p.id === id);
				const qty = cart[id];
				return { ...prod, qty, subtotal: prod.price * qty };
			});
		}

		function cartTotal() {
			return cartItemsList().reduce((s, it) => s + it.subtotal, 0);
		}

		// UI
		const cartToggle = document.getElementById('cartToggle');
		const cartPanel = document.getElementById('cartPanel');
		const cartItemsDiv = document.getElementById('cartItems');
		const cartCount = document.getElementById('cartCount');
		const cartTotalEl = document.getElementById('cartTotal');
		const cartMessages = document.getElementById('cartMessages');

		cartToggle.addEventListener('click', () => {
			const show = cartPanel.style.display === 'none' || cartPanel.style.display === '';
			cartPanel.style.display = show ? 'block' : 'none';
			cartPanel.setAttribute('aria-hidden', show ? 'false' : 'true');
		});

		document.addEventListener('click', (e) => {
			if (e.target.matches('.add-btn')) {
				addToCart(e.target.dataset.id, 1);
			}
		});

		function updateCartUI() {
			const items = cartItemsList();
			cartItemsDiv.innerHTML = '';
			if (items.length === 0) {
				cartItemsDiv.innerHTML = '<div class="small-muted">Cart is empty.</div>';
			} else {
				items.forEach(it => {
					const itemDiv = document.createElement('div');
					itemDiv.className = 'cart-item';
					itemDiv.innerHTML = `
						<img src="${it.image}" alt="${it.title}" />
						<div style="flex:1">
							<div><strong>${it.title}</strong></div>
							<div class="small-muted">$${format(it.price)} each</div>
							<div style="margin-top:6px;">
								Qty: <input class="qty-input" type="number" min="0" value="${it.qty}" data-id="${it.id}" />
								<span style="margin-left:8px;">Subtotal: $${format(it.subtotal)}</span>
							</div>
						</div>
						<button class="button" data-action="remove" data-id="${it.id}">Remove</button>
					`;
					cartItemsDiv.appendChild(itemDiv);
				});
			}
			cartCount.textContent = items.reduce((s, i) => s + i.qty, 0);
			cartTotalEl.textContent = format(cartTotal());
			renderPayPalButtons(); // re-render with current total
		}

		// Listen to qty changes & remove buttons
		cartItemsDiv.addEventListener('change', (e) => {
			if (e.target.classList.contains('qty-input')) {
				const id = e.target.dataset.id;
				const v = parseInt(e.target.value || '0', 10);
				changeQty(id, v);
			}
		});
		cartItemsDiv.addEventListener('click', (e) => {
			if (e.target.dataset.action === 'remove') {
				removeFromCart(e.target.dataset.id);
			}
		});

		// Messages
		function showTemporaryMessage(msg, type='info') {
			cartMessages.innerHTML = `<div class="${type === 'success' ? 'success' : ''}">${msg}</div>`;
			setTimeout(()=> cartMessages.innerHTML = '', 3500);
		}

		// Mock contact send
		document.getElementById('sendContact').addEventListener('click', (ev) => {
			ev.preventDefault();
			showTemporaryMessage('Thanks — your message was "sent" (demo).', 'success');
		});

		// Mock card flow (client-only demo)
		document.getElementById('mockCard').addEventListener('click', () => {
			if (cartTotal() <= 0) { showTemporaryMessage('Your cart is empty.'); return; }
			// simple confirmation flow
			const proceed = confirm(`Mock pay $${format(cartTotal())} with a demo card?`);
			if (proceed) {
				// simulate successful capture
				showTemporaryMessage('Payment successful (mock). Thank you!', 'success');
				cart = {}; saveCart();
			}
		});

		// PayPal Buttons (client-only)
		let paypalButtonsRendered = false;
		function renderPayPalButtons() {
			// Remove previous buttons area before re-rendering
			const container = document.getElementById('paypalButtonsContainer');
			container.innerHTML = '';
			if (cartTotal() <= 0) {
				container.innerHTML = '<div class="small-muted">Add items to cart to enable PayPal checkout.</div>';
				return;
			}

			// render sdk buttons
			// If PayPal was not loaded, fail gracefully
			if (!window.paypal) {
				container.innerHTML = '<div class="small-muted">PayPal SDK not loaded.</div>';
				return;
			}

			// create a fresh container element for buttons
			const btnDiv = document.createElement('div');
			container.appendChild(btnDiv);

			window.paypal.Buttons({
				style: { layout: 'vertical', color: 'gold', shape: 'rect', label: 'checkout' },
				createOrder: function(data, actions) {
					const total = format(cartTotal());
					// This client-only createOrder builds the purchase_units here.
					// Production: create orders server-side and verify captures on the server.
					return actions.order.create({
						purchase_units: [{
							amount: {
								currency_code: 'USD',
								value: total,
								breakdown: {
									item_total: { currency_code: 'USD', value: total }
								}
							},
							items: cartItemsList().map(it => ({
								name: it.title,
								unit_amount: { currency_code: 'USD', value: format(it.price) },
								quantity: String(it.qty)
							}))
						}]
					});
				},
				onApprove: function(data, actions) {
					return actions.order.capture().then(function(details) {
						// Show a success message to the buyer
						const payer = details.payer.name.given_name || 'Customer';
						showTemporaryMessage(`Transaction completed by ${payer}. Thank you!`, 'success');
						// clear cart after successful (client-side) capture
						cart = {}; saveCart();
					});
				},
				onCancel: function (data) {
					showTemporaryMessage('Payment cancelled.');
				},
				onError: function (err) {
					console.error(err);
					showTemporaryMessage('An error occurred during payment.');
				}
			}).render(btnDiv);
		}

		// Initialize
		updateCartUI();
		// Ensure PayPal buttons attempt to render if cart has items when page loads
		document.addEventListener('DOMContentLoaded', () => {
			renderPayPalButtons();
		});
	</script>
</body>
</html>
